<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Santa Dashboard - 배송 대상</title>

    <link rel="stylesheet" href="./css/santa.css" />
    <script src="./js/auth.js"></script>
    <script>
        const currentUser = requireRole(["Santa"]);
    </script>
    <script defer src="./js/santa_api.js"></script>
    <script defer src="./js/santa_targets.js"></script>
    <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet"
    />
</head>

<body>
<header class="app-header navbar navbar-dark px-3" style="background: var(--santa-red);">
    <div class="d-flex align-items-center gap-2">
        <span class="logo-icon">🎅</span>
        <span class="navbar-brand mb-0 h1">SCDMS</span>
    </div>

    <h1 class="h5 mb-0 text-white position-absolute start-50 translate-middle-x page-title">
        산타 배송 관리
    </h1>

    <div class="d-flex align-items-center gap-3">
        <div class="text-end lh-1">
            <div id="header-user-name" class="text-white fw-bold small mb-1">
                사용자
            </div>
            <span id="header-user-role" class="badge bg-light text-dark rounded-pill" style="font-size: 0.7rem;">
                Role
            </span>
        </div>
        <button type="button" id="btn-logout" class="btn btn-outline-light btn-sm" onclick="logout()">로그아웃</button>
    </div>
</header>

<div class="santa-tabs">
    <div class="container px-4">
        <ul class="nav py-3">
            <li class="nav-item">
                <a href="santa.html" class="tab-item active">배송 대상</a>
            </li>
            <li class="nav-item">
                <a href="santa_group.html" class="tab-item">배송 실행</a>
            </li>
            <li class="nav-item">
                <a href="santa_logs.html" class="tab-item">배송 기록</a>
            </li>
        </ul>
    </div>
</div>

    <!-- LOADING + ERROR -->
    <div id="loaderBackdrop" class="loader-backdrop hidden">
        <div class="loader"></div>
    </div>
    <div id="errorBanner" class="error-banner hidden"></div>

    <!-- MAIN CONTENT -->
    <main class="page-container">
        <header class="page-header">
            <div>
                <h1>📦 배송 대상 관리</h1>
                <p class="page-subtitle">NICE 상태 아이들의 선물 배송 준비 화면입니다</p>
            </div>

            <!-- FILTER BAR -->
            <div class="filter-box">
                <input
                    type="text"
                    id="searchInput"
                    class="search-input"
                    placeholder="이름 / 주소 검색"
                />
                <select id="regionFilter" class="filter-select">
                    <option value="">지역 전체</option>
                </select>
                <select id="statusFilter" class="filter-select">
                    <option value="">판정 전체</option>
                    <option value="NICE">NICE</option>
                    <option value="NAUGHTY">NAUGHTY</option>
                </select>
                <select id="deliveryFilter" class="filter-select">
                    <option value="">배송상태 전체</option>
                    <option value="PENDING">PENDING</option>
                    <option value="DELIVERED">DELIVERED</option>
                </select>
            </div>
        </header>

        <!-- SUMMARY CARDS -->
        <section class="summary-box">

            <article class="summary-card summary-nice">
                <div class="summary-label">착한 아이 (NICE)</div>
                <div class="summary-value" id="niceCount">0 명</div>
            </article>

            <article class="summary-card summary-pending">
                <div class="summary-label">배송 대기중 (PENDING)</div>
                <div class="summary-value" id="pendingCount">0 건</div>
            </article>

            <article class="summary-card summary-delivered">
                <div class="summary-label">배송 완료 (DELIVERED)</div>
                <div class="summary-value" id="readyCount">0 건</div>
            </article>

        </section>

        <!-- TABLE -->
        <section class="table-section">
            <div class="table-header-row">
                <h2>배송 대상 목록</h2>
                <span class="table-hint">행을 클릭하면 아이 상세정보가 표시됩니다</span>
            </div>

            <div class="table-wrapper">
                <table class="santa-table">
                    <thead>
                        <tr>
                            <th>아이</th>
                            <th>지역</th>
                            <th>주소</th>
                            <th>1순위</th>
                            <th>2순위</th>
                            <th>3순위</th>
                            <th>판정</th>
                            <th>배송상태</th>
                        </tr>
                    </thead>
                    <tbody id="targetsTableBody"></tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- DETAIL MODAL -->
    <div id="childModalOverlay" class="santa-modal-overlay hidden">
        <div class="santa-modal">
            <header class="santa-modal-header">
                <h3 id="modalChildName">아이 상세정보</h3>
                <button id="modalCloseBtn" class="icon-btn">&times;</button>
            </header>

            <section class="santa-modal-body">
                <div class="modal-row">
                    <span class="modal-label">주소</span>
                    <span id="modalAddress" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">지역</span>
                    <span id="modalRegion" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">판정</span>
                    <span id="modalStatus"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">배송상태</span>
                    <span id="modalDeliveryStatus" ></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">메모</span>
                    <span id="modalNote" class="modal-value"></span>
                </div>

                <h4 class="wishlist-title">🎁 위시리스트</h4>
                <table class="santa-table small">
                    <thead>
                        <tr>
                            <th>우선순위</th>
                            <th>Gift</th>
                        </tr>
                    </thead>
                    <tbody id="modalWishlistBody"></tbody>
                </table>
            </section>

            <footer class="santa-modal-footer">
                <button id="modalCloseFooter" class="primary-btn">닫기</button>
            </footer>
        </div>
    </div>

</body>
</html>
