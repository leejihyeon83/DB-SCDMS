<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>SCDMS - 선물 제작 (GiftElf)</title>
  <script src="/js/auth.js"></script>
  <script>const currentUser=requireRole(["GiftElf"]);</script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="css/gift_elf.css"/>
</head>

<body data-page="production">
  <header class="app-header navbar navbar-dark px-3">
    <div class="d-flex align-items-center gap-2">
      <span class="logo-icon">🎁</span>
      <span class="navbar-brand h1 mb-0">SCDMS</span>
    </div>

    <h1 class="h5 mb-0 text-white position-absolute start-50 translate-middle-x page-title" style="font-weight: bold;">
      GiftElf Page
    </h1>

    <div class="d-flex align-items-center gap-3">
      <div class="text-end lh-1">
        <div id="header-user-name" class="text-white small fw-bold mb-1">사용자</div>
        <span id="header-user-role" class="badge bg-success rounded-pill" style="font-size: .7rem;">Role</span>
      </div>
      <button id="btn-logout" class="btn btn-outline-light btn-sm">로그아웃</button>
    </div>
  </header>

  <main class="container my-4">
    <ul class="nav nav-pills mb-3 tab-bar">
      <li class="nav-item"><a class="nav-link" href="gift_elf_materials.html">재료 채굴</a></li>
      <li class="nav-item"><a class="nav-link active" href="gift_elf_production.html">선물 제작</a></li>
      <li class="nav-item"><a class="nav-link" href="gift_elf_demand.html">수요 분석</a></li>
    </ul>

    <div class="row g-4 mb-4">
      <section class="col-lg-6">
        <div class="card p-3 h-100 d-flex flex-column">
          <h2 class="h6 mb-2">선물 제작</h2>
          
          <!-- 선물 리스트 -->
          <div style="flex-grow: 1; overflow-y: auto;">
            <ul id="gift-list" class="list-group mb-3"></ul>
          </div>

          <div class="d-flex mt-auto pt-3 border-top gift-production-controls align-items-center">
  
            <!-- 수량 조절 묶음 -->
            <div class="qty-control-wrapper d-flex align-items-center">
              <button id="btn-qty-minus" class="btn btn-qty-cute" type="button">-</button>

              <input id="produce-quantity" type="number" min="1" value="1"
                    class="form-control text-center qty-input-cute" />

              <button id="btn-qty-plus" class="btn btn-qty-cute" type="button">+</button>
            </div>

            <!-- 제작 시작 버튼 -->
            <button id="btn-start-production" type="button" class="btn btn-production">
              제작 시작
            </button>
          </div>
        </div>
      </section>

      <section class="col-lg-6">
        <div class="card p-3 h-100">
          <h2 class="h6 mb-2">선물 재고</h2>
          <div class="table-responsive">
             <table class="table table-sm custom-table align-middle" id="gift-stock-table">
               <thead class="table-green-header">
                 <tr><th>선물 이름</th><th class="text-end">재고</th></tr>
               </thead>
               <tbody></tbody>
             </table>
          </div>
        </div>
      </section>
    </div>

    <!-- 내 생산로그 -->
    <section class="mb-4">
      <div class="card p-4">
        <h2 class="h6 mb-3">내 생산로그</h2>
        <div class="table-responsive log-table-scroll-container custom-scrollbar">
          <table class="table table-hover align-middle custom-table">
            <thead class="table-green-header sticky-top">
              <tr>
                <th style="width: 15%">로그 ID</th>
                <th style="width: 40%">시간</th>
                <th style="width: 30%">선물</th>
                <th class="text-end" style="width: 15%">수량</th>
              </tr>
            </thead>
            <tbody id="my-log-body">
              <tr><td colspan="4" class="text-center text-muted small p-3">기록을 불러오는 중...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 전체 생산로그 (전체 너비 + 필터) -->
    <section class="mb-5">
      <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h6 mb-0">전체 생산로그</h2>
          
          <!-- 필터링 드롭다운 -->
          <div class="d-flex align-items-center gap-2">
            <label for="elf-filter" class="small fw-bold text-muted">요정별 보기</label>
            <select id="elf-filter" class="form-select form-select-sm w-auto border-success text-success fw-bold" style="min-width: 140px;">
              <option value="all">전체 요정</option>
              <!-- js에서 동적으로 채워짐 -->
            </select>
          </div>
        </div>

        <div class="table-responsive log-table-scroll-container custom-scrollbar">
          <table class="table table-hover align-middle custom-table">
            <thead class="table-green-header sticky-top">
              <tr>
                <th style="width: 15%">로그 ID</th>
                <th style="width: 40%">시간</th>
                <th style="width: 30%">선물</th>
                <th class="text-end" style="width: 15%">수량</th>
              </tr>
            </thead>
            <tbody id="all-log-body">
              <tr><td colspan="4" class="text-center text-muted small p-3">기록을 불러오는 중...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast-custom d-none"></div>

  <!-- 레시피 모달 -->
  <div class="modal fade" id="recipeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="recipeModalLabel">레시피</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="recipeModalBody">
        <!-- js로 내용 채워짐 -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/gift_elf_production.js"></script>
</body>
</html>